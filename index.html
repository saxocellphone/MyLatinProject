<!DOCTYPE html>
<html>
	<head>
		<title>A solids of revolution graphing calculator</title>
		<link rel="shortcut icon" href="https://lh6.googleusercontent.com/-eJP7CsCRims/AAAAAAAAAAI/AAAAAAAAAOE/9fdQHCWUWQs/s32-c-k-no/photo.jpg"/>
		<meta charset="UTF-8">
	</head>

	<body>

		<script src="js/three.min.js"></script>
		<script src="js/CanvasInput.js"></script>
		<script src="js/ThreeCSG.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/ColladaLoader.js"></script>
		<script src="js/Frontend.js"></script>
		<script src="js/TrackballControls.js"></script>
		<script src='js/threex.domevent.js'></script>
		<script>

			var camera, scene, renderer, loader, clock, controls;
			var raycaster = new THREE.Raycaster();
			var mouse = new THREE.Vector2();
			clock = new THREE.Clock();
			var loader = new THREE.JSONLoader();
			var gameCode;
			var multiplayer;
			var backend;
			var pieceArray =[];
			startScreen();

			function startScreen(){
				var selectionBar = document.createElement("select");
				selectionBar.appendChild (new Option ("Single-player", "singleplayer"));
				selectionBar.appendChild (new Option ("Multi-player", "multiplayer"));
				var startButton = document.createElement("button");
				startButton.textContent="Start game";
				startButton.addEventListener("click", function(e){
					//backend = new Backend(Frontend, selectionBar.value,gameCode);
					if(selectionBar.value="singleplayer"){
						multiplayer = false;
						init();
					} else {
						multiplayer = true;
						init();
					}
				});
				var connectButton = document.createElement("button");
				connectButton.textContent="Connect";
				connectButton.addEventListener("click", function(e){
					gameCode = prompt("please enter your game code:", "10 digit long code");
				});
				document.body.appendChild(selectionBar);
				document.body.appendChild(startButton);
				document.body.appendChild(connectButton);
			}

			function init(){
				if(!Detector.webgl){  //No WebGL D:
					Detector.addGetWebGLMessage();
					return;
				}
				scene=new THREE.Scene();

				camera=new THREE.PerspectiveCamera(90, 1, 1, 1000);
				camera.position.set(0,0,5);
				// camera.rotation.set(0,0,0);
				renderer=new THREE.WebGLRenderer({antialias: true});
				renderer.setSize(1000, 1000);
				controls=new THREE.TrackballControls(camera);
				controls.addEventListener('change', render);
				controls.rotateSpeed=1;
				controls.staticMoving = true;
				document.body.appendChild(renderer.domElement);
				addLights();
				animate();
				addAxis();
				Frontend.new(4,3,"red","eagle");
				Frontend.new(4,2,"white","soldier");
				Frontend.new(4,1,"red","eagle");
				Frontend.new(4,0,"white","soldier");
				Frontend.new(4,5,"red","eagle");
				Frontend.new(4,4,"white","soldier");
				document.addEventListener( 'mousedown', onDocumentMouseDown, false );
				document.addEventListener( 'touchstart', onDocumentTouchStart, false );
			}
			function onDocumentTouchStart( event ) {

							event.preventDefault();

							event.clientX = event.touches[0].clientX;
							event.clientY = event.touches[0].clientY;
							onDocumentMouseDown( event );

						}
			function onDocumentMouseDown( event ) {
				event.preventDefault();

    			mouse.x = ( event.clientX / renderer.domElement.width ) * 2 - 1;
    			mouse.y = - ( event.clientY / renderer.domElement.height ) * 2 + 1;

    			raycaster.setFromCamera( mouse, camera );

    			var intersects = raycaster.intersectObjects(scene.children, true);

    			if ( intersects.length > 0) {

        			intersects[0].object.callback();
    			}
			}

			function animate(){
				THREE.AnimationHandler.update(clock.getDelta());
				controls.update();
				requestAnimationFrame(animate);
			}

			var renderQueued = false;
			function render(){


				if(!renderQueued){
					requestAnimationFrame(function(){
						renderer.render(scene, camera);
						renderer.setClearColor(0xFFCC66, 1);
						renderQueued = false;
					});
					renderQueued = true;
				}
			}

			function addLights(){
				var ambientLight=new THREE.HemisphereLight(0xffffff,0xffffff,0.7);
				scene.add(ambientLight);

			}

			function addAxis(){
				var geometry=new THREE.Geometry();
				var geometry1=new THREE.Geometry();
				var geometry2=new THREE.Geometry();
				for(var i=-3; i<5; i++){
					geometry.vertices.push(new THREE.Vector3(-4, i, 0));
					geometry.vertices.push(new THREE.Vector3(4, i, 0));
					geometry.vertices.push(new THREE.Vector3(i, -4, 0));
					geometry.vertices.push(new THREE.Vector3(i, 4, 0));
				}
				geometry1.vertices.push(new THREE.Vector3(-4, -4, 0));
				geometry1.vertices.push(new THREE.Vector3(-4, 4, 0));
				geometry2.vertices.push(new THREE.Vector3(-4, -4, 0));
				geometry2.vertices.push(new THREE.Vector3(4, -4, 0));
				var line = new THREE.Line(geometry, new THREE.LineBasicMaterial(), THREE.LinePieces);
				line.callback = function(){
					console.log("hi");
				}
				line.position.x +=0.5;
				line.position.y +=0.5;
				var line1 = new THREE.Line(geometry1, new THREE.LineBasicMaterial(), THREE.LinePieces);
				line1.position.x +=0.5;
				line1.position.y +=0.5;
				var line2 = new THREE.Line(geometry2, new THREE.LineBasicMaterial(), THREE.LinePieces);
				line2.position.x +=0.5;
				line2.position.y +=0.5;
				// scene.add(line);
				// scene.add(line1);
				// scene.add(line2);
			}

			function Piece(x,y,color,eaglep){
				var x,y,color,eaglep,mesh;
				this.eaglep = eaglep;
				this.x = x;
				this.y = y;
				this.color = color;
				this.mesh = mesh;
			}

			Piece.prototype.load = function(){
				var x = this.x;
				var y = this.y;
				var eaglep = this.eaglep;
				var color = this.color;
				var mesh = this.mesh;
				loader.load(eaglep+'.json', function (geometry, materials) {
					var materials = new THREE.MeshPhongMaterial({color});
					mesh = new THREE.SkinnedMesh(geometry, materials);
					mesh.scale.set( 0.2, 0.2, 0.2 );
					mesh.position.y = y-3;
					mesh.position.x = x-3;
					mesh.rotation.x = 3.14/2;
					mesh.name = "test";
					if(color=="white"){
						mesh.rotation.y = 3.14;
					} else {
						mesh.rotation.y = 0;
					}
					mesh.callback = function(){
						console.log("hi");
					}
					scene.add(mesh);
					render();
				});
			}

			Piece.prototype.move = function(endX, endY){
				//scene.remove(this.mesh);
				render();
			}

		</script>
	</body>
</html>
